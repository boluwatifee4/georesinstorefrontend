<div
  class="min-h-screen bg-gradient-to-br from-violet-50 via-white to-purple-50 dark:from-violet-950 dark:via-slate-900 dark:to-purple-950"
>
  <div
    class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8 max-w-7xl"
  >
    <!-- Success State: Order Saved (NOT Payment Declared) -->
    <div
      *ngIf="saveOrderResult() && !orderResult()"
      class="max-w-2xl mx-auto px-4 sm:px-0"
    >
      <div
        class="bg-white dark:bg-slate-800 rounded-3xl shadow-lg border border-gray-100 dark:border-slate-700 overflow-hidden"
      >
        <div
          class="bg-gradient-to-r from-violet-600 to-purple-600 p-6 sm:p-8 text-center"
        >
          <div
            class="w-12 h-12 sm:w-16 sm:h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4"
          >
            <svg
              class="w-6 h-6 sm:w-8 sm:h-8 text-violet-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
          </div>
          <h1 class="text-xl sm:text-2xl font-bold text-white mb-2">
            Order Saved!
          </h1>
          <p class="text-violet-100 text-sm sm:text-base">
            You can declare your payment later using the order code
          </p>
        </div>
        <div class="p-4 sm:p-6 lg:p-8 space-y-4 sm:space-y-6">
          <div
            class="bg-gray-50 dark:bg-slate-700 rounded-xl p-4 sm:p-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
          >
            <div class="flex-1">
              <h3
                class="font-semibold text-gray-900 dark:text-white mb-2 text-sm sm:text-base"
              >
                Order Code
              </h3>
              <p
                class="text-xl sm:text-2xl font-mono font-bold text-violet-600 dark:text-violet-400 break-all"
              >
                {{ saveOrderResult()?.orderCode }}
              </p>
              <p
                class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1 sm:mt-2"
              >
                Keep this code to declare payment later
              </p>
            </div>
            <button
              (click)="copyOrderCode()"
              class="p-2.5 sm:p-3 bg-violet-100 dark:bg-violet-900/30 text-violet-600 dark:text-violet-400 rounded-lg hover:bg-violet-200 dark:hover:bg-violet-900/50 transition-colors flex-shrink-0"
            >
              <svg
                class="w-4 h-4 sm:w-5 sm:h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                />
              </svg>
            </button>
          </div>

          <div
            class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 sm:p-6 text-xs sm:text-sm text-amber-700 dark:text-amber-300"
          >
            <p class="mb-2 font-medium">Next Steps</p>
            <ul class="list-disc list-inside space-y-1">
              <li>
                When ready, go to Declare Payment page and use your order code
              </li>
              <li>
                We will confirm delivery fee if pending before fulfillment
              </li>
            </ul>
          </div>

          <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
            <button
              (click)="startNewOrder()"
              class="flex-1 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 rounded-xl hover:bg-gray-50 dark:hover:bg-slate-600 transition-all duration-200 font-medium"
            >
              Continue Shopping
            </button>
            <button
              routerLink="/store/orders/lookup"
              class="flex-1 py-2.5 sm:py-3 text-sm sm:text-base bg-gradient-to-r from-violet-600 to-purple-600 text-white rounded-xl hover:from-violet-700 hover:to-purple-700 transition-all duration-200 font-semibold shadow-lg"
            >
              Declare Payment Later
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout Form -->
    <div
      *ngIf="!orderResult() && !saveOrderResult()"
      class="grid grid-cols-1 xl:grid-cols-3 gap-6 lg:gap-8"
    >
      <!-- Checkout Form -->
      <div class="xl:col-span-2 order-1">
        <div
          class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 p-4 sm:p-6 lg:p-8"
        >
          <!-- Header -->
          <div
            class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 sm:mb-8"
          >
            <div class="flex-1">
              <h1
                class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-violet-700 to-purple-600 bg-clip-text text-transparent flex items-center gap-2"
              >
                Checkout
                <span
                  class="text-3xl sm:text-4xl filter drop-shadow animate-bounce"
                  >üéÅ</span
                >
              </h1>
              <p
                class="text-gray-600 dark:text-gray-400 mt-1 sm:mt-2 text-sm sm:text-base"
              >
                Complete your order details
              </p>
            </div>
            <button
              (click)="goBackToCart()"
              class="p-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10 19l-7-7m0 0l7-7m-7 7h18"
                ></path>
              </svg>
            </button>
          </div>

          <!-- Error Display -->
          <div
            *ngIf="error()"
            class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 mb-6"
          >
            <div class="flex items-center gap-3">
              <svg
                class="w-5 h-5 text-red-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <p class="text-red-700 dark:text-red-300 font-medium">
                {{ error() }}
              </p>
            </div>
          </div>

          <!-- Form -->
          <form
            [formGroup]="checkoutForm"
            (ngSubmit)="declarePayment()"
            class="space-y-6 sm:space-y-8"
          >
            <!-- Prefill Confirmation Banner -->
            <div
              *ngIf="
                checkoutForm.get('buyerName')?.pristine &&
                checkoutForm.get('buyerName')?.value
              "
              class="rounded-xl border bg-indigo-50 dark:bg-indigo-900/20 border-indigo-200 dark:border-indigo-700 p-4 flex items-start gap-3"
            >
              <svg
                class="w-5 h-5 text-indigo-500 dark:text-indigo-300 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
              </svg>
              <div class="text-xs sm:text-sm flex-1">
                <p
                  class="font-medium text-indigo-800 dark:text-indigo-200 mb-1"
                >
                  Prefilled Details
                </p>
                <p class="text-indigo-700 dark:text-indigo-300 mb-2">
                  We loaded your last checkout details. Please confirm they are
                  still correct or update as needed.
                </p>
                <div class="flex flex-col sm:flex-row gap-2">
                  <button
                    type="button"
                    (click)="checkoutForm.markAllAsTouched()"
                    class="px-3 py-2 text-xs sm:text-sm rounded-lg bg-white dark:bg-slate-700 border border-indigo-300 dark:border-indigo-600 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-100 dark:hover:bg-slate-600 transition"
                  >
                    Edit / Update
                  </button>
                  <button
                    type="button"
                    (click)="acknowledgeDelivery.set(true)"
                    class="px-3 py-2 text-xs sm:text-sm rounded-lg bg-gradient-to-r from-violet-600 to-purple-600 text-white hover:from-violet-700 hover:to-purple-700 transition"
                  >
                    Confirm Details
                  </button>
                </div>
              </div>
            </div>

            <!-- Personal Information -->
            <div>
              <h2
                class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4"
              >
                Personal Information
              </h2>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                <div class="md:col-span-2">
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Full Name *
                  </label>
                  <input
                    type="text"
                    formControlName="buyerName"
                    [class]="
                      'w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all duration-200 ' +
                      (isFieldInvalid('buyerName')
                        ? 'border-red-500 dark:border-red-400'
                        : 'border-gray-300 dark:border-slate-600')
                    "
                    placeholder="Enter your full name"
                  />
                  <div
                    *ngIf="getFieldError('buyerName')"
                    class="text-red-500 text-sm mt-1"
                  >
                    {{ getFieldError("buyerName") }}
                  </div>
                </div>

                <div>
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Phone Number *
                  </label>
                  <input
                    type="tel"
                    formControlName="phone"
                    [class]="
                      'w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all duration-200 ' +
                      (isFieldInvalid('phone')
                        ? 'border-red-500 dark:border-red-400'
                        : 'border-gray-300 dark:border-slate-600')
                    "
                    placeholder="080 1234 5678"
                  />
                  <div
                    *ngIf="getFieldError('phone')"
                    class="text-red-500 text-sm mt-1"
                  >
                    {{ getFieldError("phone") }}
                  </div>
                </div>

                <div>
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    Email Address
                  </label>
                  <input
                    type="email"
                    formControlName="email"
                    [class]="
                      'w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all duration-200 ' +
                      (isFieldInvalid('email')
                        ? 'border-red-500 dark:border-red-400'
                        : 'border-gray-300 dark:border-slate-600')
                    "
                    placeholder="your@email.com"
                  />
                  <div
                    *ngIf="getFieldError('email')"
                    class="text-red-500 text-sm mt-1"
                  >
                    {{ getFieldError("email") }}
                  </div>
                </div>

                <div class="md:col-span-2">
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                  >
                    WhatsApp Number
                  </label>
                  <input
                    type="tel"
                    formControlName="whatsapp"
                    [class]="
                      'w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all duration-200 ' +
                      (isFieldInvalid('whatsapp')
                        ? 'border-red-500 dark:border-red-400'
                        : 'border-gray-300 dark:border-slate-600')
                    "
                    placeholder="080 1234 5678"
                  />
                  <div
                    *ngIf="getFieldError('whatsapp')"
                    class="text-red-500 text-sm mt-1"
                  >
                    {{ getFieldError("whatsapp") }}
                  </div>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    Optional: Provide additional contact methods (email or
                    WhatsApp)
                  </p>
                </div>
              </div>
            </div>

            <!-- Delivery Information -->
            <div>
              <h2
                class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4"
              >
                Delivery Information
              </h2>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  Delivery Location *
                </label>
                <input
                  type="text"
                  formControlName="locationLabel"
                  [class]="
                    'w-full px-3 sm:px-4 py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 border rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent transition-all duration-200 ' +
                    (isFieldInvalid('locationLabel')
                      ? 'border-red-500 dark:border-red-400'
                      : 'border-gray-300 dark:border-slate-600')
                  "
                  placeholder="Enter your city, state, or full address"
                />
                <div
                  *ngIf="getFieldError('locationLabel')"
                  class="text-red-500 text-sm mt-1"
                >
                  {{ getFieldError("locationLabel") }}
                </div>

                <!-- Within Ogbomoso Checkbox -->
                <div
                  class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border-2 border-blue-200 dark:border-blue-700 rounded-xl"
                >
                  <label class="flex items-start gap-4 cursor-pointer group">
                    <input
                      type="checkbox"
                      formControlName="withinOgbomoso"
                      class="mt-1 w-5 h-5 text-blue-600 bg-white dark:bg-slate-700 border-2 border-blue-300 dark:border-blue-600 rounded focus:ring-blue-500 focus:ring-2 transition-all duration-200"
                    />
                    <div class="flex-1">
                      <span
                        class="text-sm font-semibold text-blue-800 dark:text-blue-200 group-hover:text-blue-900 dark:group-hover:text-blue-100 transition-colors"
                      >
                        Check this box if your delivery location is within
                        Ogbomoso city
                      </span>
                      <p class="text-xs text-blue-600 dark:text-blue-300 mt-1">
                        ‚úì Check this to get local delivery rates for Ogbomoso
                        city locations
                      </p>
                    </div>
                  </label>
                </div>

                <div
                  class="mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"
                >
                  <div class="flex items-start gap-3">
                    <svg
                      class="w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    <div class="text-sm text-blue-700 dark:text-blue-300">
                      <p class="font-medium mb-1">Delivery Information</p>
                      <p *ngIf="!checkoutForm.get('withinOgbomoso')?.value">
                        We prepare your order and move it from our store to the
                        designated park for a flat fee of ‚Ç¶1,000. When the items
                        arrive at the park, the onward delivery (park to your
                        final destination) is negotiated directly between you
                        and the driver.
                      </p>
                      <p *ngIf="checkoutForm.get('withinOgbomoso')?.value">
                        Delivery fees within Ogbomoso vary depending on your
                        location, typically ranging between ‚Ç¶500 and ‚Ç¶1,000. The
                        rider will contact you directly to confirm the exact
                        fee.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="xl:col-span-1 order-2">
        <div
          class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-gray-100 dark:border-slate-700 p-4 sm:p-6 xl:sticky xl:top-6"
        >
          <h2
            class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6"
          >
            Order Summary
          </h2>

          <!-- Cart Items Summary -->
          <div
            class="space-y-3 mb-4 sm:mb-6 max-h-48 sm:max-h-60 overflow-y-auto"
          >
            <div
              *ngFor="let item of cartItems(); trackBy: trackByItemId"
              class="flex items-center gap-2 sm:gap-3 p-2 sm:p-3 bg-gray-50 dark:bg-slate-700 rounded-lg"
            >
              <div
                class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-violet-100 to-purple-100 dark:from-violet-900/30 dark:to-purple-900/30 rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5 sm:w-6 sm:h-6 text-violet-500 dark:text-violet-300"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m2 2a9 9 0 11-9-9 9 9 0 019 9z"
                  />
                </svg>
              </div>

              <div class="flex-1 min-w-0">
                <p
                  class="font-medium text-gray-900 dark:text-white text-xs sm:text-sm truncate"
                >
                  {{ item.titleSnap }}
                </p>
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  Qty: {{ item.qty }}
                </p>
              </div>

              <div class="text-right">
                <p
                  class="font-semibold text-gray-900 dark:text-white text-xs sm:text-sm"
                >
                  ‚Ç¶{{ lineItemTotal(item) }}
                </p>
              </div>
            </div>
          </div>

          <!-- Totals -->
          <div class="space-y-3 mb-6">
            <div class="flex justify-between items-center">
              <span class="text-gray-600 dark:text-gray-400">Subtotal</span>
              <span class="font-semibold text-gray-900 dark:text-white">{{
                formattedSubtotal()
              }}</span>
            </div>

            <div
              *ngIf="!withinOgbomoso()"
              class="flex justify-between items-center"
            >
              <span class="text-gray-600 dark:text-gray-400"
                >Delivery (to park)</span
              >
              <span class="font-semibold text-gray-900 dark:text-white">{{
                formattedDeliveryFee()
              }}</span>
            </div>
            <div
              *ngIf="withinOgbomoso()"
              class="flex justify-between items-center"
            >
              <span class="text-gray-600 dark:text-gray-400">Delivery</span>
              <span class="font-semibold text-gray-900 dark:text-white"
                >Excluded</span
              >
            </div>

            <hr class="border-gray-200 dark:border-slate-600" />

            <div class="flex justify-between items-center text-lg">
              <span class="font-semibold text-gray-900 dark:text-white"
                >Total</span
              >
              <span class="font-bold text-violet-600 dark:text-violet-400">
                {{ formattedTotal() }}
              </span>
            </div>
          </div>

          <!-- Delivery Fee Acknowledgment -->
          <div class="mb-4 sm:mb-5">
            <div
              class="p-3 sm:p-4 rounded-xl border text-xs sm:text-sm transition-all duration-300 relative"
              [ngClass]="
                acknowledgeDelivery()
                  ? 'bg-violet-50 border-violet-300 dark:bg-violet-900/20 dark:border-violet-700'
                  : 'bg-amber-50 border-amber-400 dark:bg-amber-900/30 dark:border-amber-600'
              "
            >
              <div class="absolute -top-2.5 right-3 sm:right-4">
                <span
                  class="px-2 py-0.5 rounded-full text-[9px] sm:text-[10px] font-semibold tracking-wide uppercase"
                  [ngClass]="
                    acknowledgeDelivery()
                      ? 'bg-violet-600 text-white dark:bg-violet-500'
                      : 'bg-amber-500 text-white'
                  "
                >
                  {{ acknowledgeDelivery() ? "Acknowledged" : "Required" }}
                </span>
              </div>

              <div class="flex items-start gap-2 sm:gap-3">
                <svg
                  class="w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0 mt-0.5"
                  [ngClass]="
                    acknowledgeDelivery()
                      ? 'text-violet-500 dark:text-violet-300'
                      : 'text-amber-500 dark:text-amber-300'
                  "
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                <div class="flex-1">
                  <p
                    class="font-medium mb-1 sm:mb-2 text-xs sm:text-sm"
                    [ngClass]="
                      acknowledgeDelivery()
                        ? 'text-violet-800 dark:text-violet-200'
                        : 'text-amber-800 dark:text-amber-200'
                    "
                  >
                    Delivery Information
                  </p>
                  <ul class="text-xs space-y-1 mb-2 sm:mb-3">
                    <li *ngIf="!withinOgbomoso()">
                      ‚Ä¢ ‚Ç¶1,000 covers moving your items from our store to the
                      park
                    </li>
                    <li *ngIf="!withinOgbomoso()">
                      ‚Ä¢ You negotiate the park-to-final-location cost directly
                      with the rider
                    </li>
                    <li *ngIf="withinOgbomoso()">
                      ‚Ä¢ Delivery within Ogbomoso doesn't include park transfer
                      fee
                    </li>
                    <li *ngIf="withinOgbomoso()">
                      ‚Ä¢ You may still negotiate a final hand‚Äëoff cost
                    </li>
                    <li>
                      After confirmation, we'll contact you with coordination
                      details
                    </li>
                  </ul>

                  <label
                    class="flex items-start gap-2 sm:gap-3 cursor-pointer mt-2 group"
                  >
                    <input
                      type="checkbox"
                      class="mt-0.5 sm:mt-1 h-4 w-4 sm:h-5 sm:w-5 rounded border-gray-300 text-violet-600 focus:ring-violet-500 focus:ring-2 transition"
                      (change)="onAcknowledgeChange($event)"
                    />
                    <span
                      class="text-xs sm:text-sm leading-relaxed"
                      [ngClass]="
                        acknowledgeDelivery()
                          ? 'text-gray-700 dark:text-gray-300'
                          : 'font-medium text-amber-800 dark:text-amber-200'
                      "
                    >
                      Check this box to confirm you understand the delivery
                      process and agree to pickup from the designated park
                      location.
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="space-y-2 sm:space-y-3">
            <button
              type="button"
              (click)="onClickSaveOrder()"
              [disabled]="isSavingOrder() || isPlacingOrder()"
              class="w-full py-2.5 sm:py-3 text-sm sm:text-base bg-white dark:bg-slate-700 text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 rounded-xl hover:bg-gray-50 dark:hover:bg-slate-600 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span *ngIf="!isSavingOrder()">Save Order (Pay Later)</span>
              <span
                *ngIf="isSavingOrder()"
                class="flex items-center justify-center gap-2"
              >
                <div
                  class="animate-spin rounded-full h-4 w-4 border-b-2 border-current"
                ></div>
                Saving...
              </span>
            </button>

            <button
              type="button"
              (click)="onClickDeclarePayment()"
              [disabled]="isPlacingOrder() || isSavingOrder()"
              class="w-full py-3 sm:py-4 text-sm sm:text-base bg-gradient-to-r from-violet-600 to-purple-600 text-white rounded-xl hover:from-violet-700 hover:to-purple-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
            >
              <span *ngIf="!isPlacingOrder()">Declare Payment</span>
              <span
                *ngIf="isPlacingOrder()"
                class="flex items-center justify-center gap-2"
              >
                <div
                  class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"
                ></div>
                Processing...
              </span>
            </button>

            <p
              class="text-xs text-gray-500 dark:text-gray-400 text-center mt-1 sm:mt-2"
            >
              Save Order: Get order code and pay later<br
                class="hidden sm:block"
              />
              <span class="sm:hidden"> ‚Ä¢ </span>Declare Payment: Get bank
              details immediately and confirm payment
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <app-payment-modal
    *ngIf="showPaymentModal()"
    [totalAmount]="formattedTotal()"
    [cartId]="cartId()!"
    [buyerName]="checkoutForm.get('buyerName')?.value"
    [phone]="checkoutForm.get('phone')?.value || undefined"
    [email]="checkoutForm.get('email')?.value || undefined"
    [whatsapp]="checkoutForm.get('whatsapp')?.value || undefined"
    [locationLabel]="checkoutForm.get('locationLabel')?.value"
    (onClose)="onPaymentModalClose()"
    (onPaymentConfirmed)="onPaymentConfirmed($event)"
  ></app-payment-modal>
</div>
